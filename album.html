<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opium Music Player</title>
    <!-- Include Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #000000;
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }
        .back-button {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.5rem;
            color: #ffffff;
            background: none;
            border: none;
            cursor: pointer;
            transition: color 0.3s;
        }
        .back-button:hover {
            color: #1f8fff;
        }
        .album-container {
            padding: 20px;
            text-align: center;
        }
        .album-card {
            display: inline-block;
            margin: 20px;
            background: #1f1f1f;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }
        .album-card img {
            width: 200px;
            height: 200px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        .album-card h3 {
            font-size: 1.5rem;
        }
        .album-card ul {
            list-style: none;
            padding: 0;
        }
        .album-card ul li {
            margin: 5px 0;
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #2c2c2c;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .album-card ul li.playing {
            background-color: #1f8fff;
        }
        .play-icon {
            color: #ffffff;
            font-size: 1.5rem;
            margin-right: 10px;
            cursor: pointer;
            transition: color 0.3s;
        }
        .play-icon:hover {
            color: #1f8fff;
        }
        .song-name {
            flex-grow: 1;
            text-align: left;
        }
        a {
            color: #ffffff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .player-strip {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #1f1f1f;
            padding: 10px;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .player-strip img {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            margin-right: 10px;
        }
        .player-strip .song-info {
            flex-grow: 1;
            display: flex;
            align-items: center;
        }
        .player-strip .song-info span {
            margin-left: 10px;
        }
        .player-strip .controls {
            display: flex;
            align-items: center;
        }
        .player-strip .controls i {
            font-size: 1.5rem;
            margin: 0 10px;
            cursor: pointer;
            transition: color 0.3s;
        }
        .player-strip .controls i:hover {
            color: #1f8fff;
        }
    </style>
</head>
<body>
    <!-- Small Back Button -->
    <button class="back-button" onclick="window.location.href='play.html'">
        <i class="fa fa-arrow-left"></i>
    </button>

    <div class="album-container" id="albumContainer">
        <!-- Album details and songs -->
    </div>

    <div class="player-strip" id="playerStrip" style="display: none;">
        <div class="song-info">
            <img id="playerAlbumImage" src="" alt="Album Art">
            <div>
                <span id="playerSongName"></span>
                <span id="playerElapsedTime">0:00</span>
            </div>
        </div>
        <div class="controls">
            <i class="fa fa-backward" id="previousButton"></i>
            <i class="fa fa-play" id="playPauseButton"></i>
            <i class="fa fa-forward" id="nextButton"></i>
        </div>
    </div>

    <!-- Audio Element -->
    <audio id="audioPlayer" preload="auto"></audio>

    <script>
        let audio = document.getElementById('audioPlayer');
        let currentSongIndex = 0;
        let currentAlbum = null;
        let playPauseButton = document.getElementById("playPauseButton");
        let playerStrip = document.getElementById("playerStrip");
        let playerSongName = document.getElementById("playerSongName");
        let playerAlbumImage = document.getElementById("playerAlbumImage");
        let playerElapsedTime = document.getElementById("playerElapsedTime");
        let elapsedTimeInterval = null;

        // Sample album data with multiple artists and albums
        const albumData = {
            "Lil Uzi": {
                "LuvIsRage": {
                    "name": "Luv is rage [deluxe]",
                    "image": "images/luvisrage.jpeg",
                    "songs": [
                        "20 Min.mp3",
                        "444+222.mp3",
                        "Dark Queen.mp3",
                        "Diamonds All on My Wrist.mp3",
                        "Early 20 Rager.mp3",
                        "Feelings Mutual.mp3",
                        "For Real.mp3",
                        "How to Talk.mp3",
                        "Loaded.mp3",
                        "Malfunction.mp3",
                        "Neon Guts (feat. Pharrell Williams).mp3",
                        "No Sleep Leak.mp3",
                        "Pretty Mami.mp3",
                        "Sauce It Up.mp3",
                        "Skir Skirr.mp3",
                        "The Way Life Goes (feat. Oh Wonder).mp3",
                        "TwoÂ®.mp3",
                        "UnFazed (feat. The Weeknd).mp3",
                        "X.mp3",
                        "XO Tour Llif3.mp3"
                    ]
                }
            },
            "Ken Carson": {
                "GreatChoas": {
                    "name": "Great Choas [deluxe]",
                    "image": "images/greatchoas.jpeg",
                    "songs": [
                        "ss.mp3",
                        "overseas.mp3"
                    ]
                }
            }
        };

        // Function to get the query parameter from the URL
        function getQueryParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Function to load the album based on the query
        function loadAlbum(artistName, albumName) {
            currentAlbum = albumData[artistName] && albumData[artistName][albumName];

            if (currentAlbum) {
                const albumContainer = document.getElementById("albumContainer");

                // Create the album content dynamically
                albumContainer.innerHTML = `
                    <div class="album-card">
                        <img src="${currentAlbum.image}" alt="${currentAlbum.name}">
                        <h3>${currentAlbum.name}</h3>
                        <ul>
                            ${currentAlbum.songs.map((song, index) => {
                                const songName = song.replace(".mp3", ""); // Remove .mp3 from the song name
                                const encodedArtistName = encodeURIComponent(artistName);
                                const encodedAlbumName = encodeURIComponent(albumName);
                                return `
                                    <li id="song-${index}">
                                        <i class="fa fa-play play-icon" onclick="playSong(${index}, '${encodedArtistName}', '${encodedAlbumName}', '${song}', 'song-${index}')"></i>
                                        <span class="song-name">${songName}</span>
                                    </li>
                                `;
                            }).join('')}
                        </ul>
                    </div>
                `;
            } else {
                document.getElementById("albumContainer").innerHTML = "<p>Album not found.</p>";
            }
        }

        // Function to play the song
        function playSong(songIndex, artistName, albumName, song, songElementId) {
            if (audio) {
                audio.pause();
            }

            // Remove playing class from previously playing song
            const previousPlayingElement = document.querySelector('.album-card ul li.playing');
            if (previousPlayingElement) {
                previousPlayingElement.classList.remove('playing');
            }

            // Add playing class to the current song
            const currentPlayingElement = document.getElementById(songElementId);
            currentPlayingElement.classList.add('playing');

            currentSongIndex = songIndex;
            const songPath = `music/${albumName}/${encodeURIComponent(song)}`;
            audio.src = songPath;

            playerSongName.textContent = song.replace(".mp3", ""); // Display song name without .mp3
            playerAlbumImage.src = currentAlbum.image;
            playerElapsedTime.textContent = "0:00";

            audio.oncanplaythrough = () => {
                audio.play();
                startElapsedTimeUpdate();
                playPauseButton.classList.remove("fa-play");
                playPauseButton.classList.add("fa-pause");
                playerStrip.style.display = "flex";
            };

            audio.onerror = () => {
                alert('Error playing the song. Please check the file path or format.');
            };

            audio.onended = () => {
                nextSong();
            };

            // Update Media Session API if available
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: song.replace(".mp3", ""),
                    artist: artistName,
                    album: currentAlbum.name,
                    artwork: [
                        { src: currentAlbum.image, sizes: '96x96', type: 'image/jpeg' },
                        { src: currentAlbum.image, sizes: '128x128', type: 'image/jpeg' },
                        { src: currentAlbum.image, sizes: '192x192', type: 'image/jpeg' },
                        { src: currentAlbum.image, sizes: '256x256', type: 'image/jpeg' },
                        { src: currentAlbum.image, sizes: '384x384', type: 'image/jpeg' },
                        { src: currentAlbum.image, sizes: '512x512', type: 'image/jpeg' }
                    ]
                });

                navigator.mediaSession.setActionHandler('play', togglePlayPause);
                navigator.mediaSession.setActionHandler('pause', togglePlayPause);
                navigator.mediaSession.setActionHandler('previoustrack', previousSong);
                navigator.mediaSession.setActionHandler('nexttrack', nextSong);
            }
        }

        function startElapsedTimeUpdate() {
            if (elapsedTimeInterval) {
                clearInterval(elapsedTimeInterval);
            }

            elapsedTimeInterval = setInterval(() => {
                const elapsedSeconds = Math.floor(audio.currentTime);
                const minutes = Math.floor(elapsedSeconds / 60);
                const seconds = elapsedSeconds % 60;
                playerElapsedTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function togglePlayPause() {
            if (audio.paused) {
                audio.play();
                playPauseButton.classList.remove("fa-play");
                playPauseButton.classList.add("fa-pause");
            } else {
                audio.pause();
                playPauseButton.classList.remove("fa-pause");
                playPauseButton.classList.add("fa-play");
            }
        }

        function nextSong() {
            if (currentSongIndex < currentAlbum.songs.length - 1) {
                currentSongIndex++;
                const song = currentAlbum.songs[currentSongIndex];
                const artistName = getQueryParameter('artist');
                const albumName = getQueryParameter('album');
                playSong(currentSongIndex, encodeURIComponent(artistName), encodeURIComponent(albumName), song, `song-${currentSongIndex}`);
            }
        }

        function previousSong() {
            if (currentSongIndex > 0) {
                currentSongIndex--;
                const song = currentAlbum.songs[currentSongIndex];
                const artistName = getQueryParameter('artist');
                const albumName = getQueryParameter('album');
                playSong(currentSongIndex, encodeURIComponent(artistName), encodeURIComponent(albumName), song, `song-${currentSongIndex}`);
            }
        }

        playPauseButton.addEventListener("click", togglePlayPause);
        document.getElementById("nextButton").addEventListener("click", nextSong);
        document.getElementById("previousButton").addEventListener("click", previousSong);

        // Get the artist and album name from the URL and load the album
        const artistName = getQueryParameter('artist');
        const albumName = getQueryParameter('album');
        if (artistName && albumName) {
            loadAlbum(artistName, albumName);
        } else {
            document.getElementById("albumContainer").innerHTML = "<p>No album specified.</p>";
        }
    </script>
</body>
</html>
